## Структура проекта
```
.
├── dataset
│   ├── metadata.csv
│   ├── processed
│   │   └── correct
│   ├── raw
│   │   ├── correct
│   │   │   ├── 20241122_122513.mp4
│   │   │   ├── 20241122_122525.mp4
│   │   │   └── ...
│   │   └── incorrect
│   │       ├── error_body_tilt
│   │       │   ├── 20241122_124943.mp4
│   │       │   ├── 20241122_124958.mp4
│   │       |   └── ...
│   │       └── error_raised_feet
│   │           ├── 20241122_123745.mp4
│   │           ├── 20241122_124052.mp4
│   │           └── ...
│   └── README.md
├── directory_structure.txt
├── dit_structure.txt
├── outputs
│   └── models
│       └── predictions
│           └── logs
├── README.md
├── scripts
│   ├── _prepare_video.py
│   ├── video_mirroring.py
│   ├── video_split.py
│   └── ...
├── src
│   ├── inference
│   ├── __init__.py
│   ├── models
│   ├── training
│   └── utils
└── venv
```

Структуру проекта нужно периодически обновлять, чтобы у нас была хорошая документация и чтобы мы не могли запутаться в ней. Такую структуру можно легко получить, через инструмент `tree` (`sudo apt install tree`). Команда `tree` выведет в терминал всю директорию, чтобы записать ее в `.txt` файл можно использовать такую команду: `tree > directory_structure.txt`.

## Описание ключевых папок и файлов

`dataset/`: Папка с данными, разделенная на `raw` (необработанные данные) и `processed` (обработанные данные). Внутри `raw` могут быть подкаталоги для правильных и неправильных данных. Каждый подкаталог может содержать видеофайлы, например, с тренировками или ошибками выполнения упражнений.

`outputs/`: Папка для вывода, после работы модели. Включает папки для моделей, предсказаний и логов.

**`src/`**: Главная логика или ядро программы, разбитое на модули (пакеты) для разных частей проекта, таких как обучение модели, выполнение инференса, подготовка видео, анализ поз в видео, а также вспомогательные утилиты.

>[!Note]
>**Пакет** — это способ организации кода в Python. Пакет представляет собой директорию, содержащую модули (файлы с расширением `.py`) и, опционально (необязателен в Python 3.3+), файл `__init__.py`. Пакеты позволяют разбивать проект на логические части, упрощая структурирование и повторное использование кода.
>
>Сам по себе, пакет — это просто папка на диске. Модули — файлы Python (`.py`) внутри пакета.

`data_processing`: Папка с модулем для подготовки видео к обработке. Здесь будет код для нарезания видео, для создания его зеркальной версии, для размытия по гаусу и так далее.

`utils`: Папка для вспомогательных функций, классов или модулей, которые используются в проекте, но не относятся непосредственно к его основной логике. Эти утилиты должны быть переиспользуемыми и независимыми от конкретных частей приложения. Например:
- Конвертация данных, форматов, типов; 
- Парсинг и генерация JSON; 
- Шаблон для ошибок; 
- Валидация или нормализация данных; 
- Вспомогательные математические или статистические вычисления.

`video_analysis`: Папка для кода, который будет анализировать подготовленные видео и выводить результат анализа ввиде JSON-файлов, на которых уже будет учиться модель.

`venv/`: Папка для виртуальной среды, которая используется для изоляции зависимостей Python-проектов.

`README.md` и `dataset/README.md`: Документация для общего описания проекта и подробного объяснения структуры данных.

---
## Подготовка к работе:
#### 1. Установка **`Python`** и **`pip`**

Убедитесь, что у вас установлен Python и пакетный менеджер pip. Вы можете проверить это, выполнив следующие команды в терминале:
```bash
python --version
pip --version
```

Если Python не установлен, вы можете скачать его с официального сайта [Python](https://www.python.org/downloads/). Установка Python обычно включает `pip` (после установки проверьте есть ли pip, если нет установите его командой:

```bash
python -m ensurepip --upgrade
```

#### 2. Создание виртуального окружения 

`venv` (виртуальная среда Python) позволяет изолировать зависимости проекта от глобальной среды Python. Это полезно, чтобы избегать конфликтов между различными версиями библиотек в разных проектах.

Для создания виртуальной среды нужно выполнить следующую команду в терминале:

```bash
cd путь/к/вашему/проекту
python -m venv <название_среды>
```

> [!Note]
> Если использовался плагин `code runner`, то он поумолчания пытается исполнять файлы с помощью интерпретатора в директории `PATH`, тоесть с помощью глобальной среды выполнения. Но мы изалируем проект, создавая локальную папку с библеотеками и локальным интерпритатором не завясящим от глобального. Поэтому нам нужно указать, что код нужно запускать от имени интерпритатора нашей среды.
>
> Чтобы указать Code Runner использовать конкретную среду:
> 1. Откройте настройки VS Code
> 2. В строке поиска введите **Code Runner Executor Map**.
> 3. Выбрать из `User` и `Workspace` второе, так как мы не хотим, чтобы вообще везде использовалась эта среда выполнения.
> 4. Найдите настройку `code-runner.executorMap` и нажмите значок редактирования (`Edit in settings.json`).
> 5. В обьекте `"code-runner.executorMap"` нужно найти `python` и вписать вместо значения поумолчанию путь к `python`. Он будет примерно такой: `путь до проекта/venv/bin/python`.
#### 3. Активация виртуального окружения
После создания виртуального окружения его нужно активировать. Вот команды для разных ОС:

```bash
venv\Scripts\activate # Для Windows
source venv/bin/activate # Для macOS и Linux
```

После активации виртуального окружения вкратце произойдет это:
- Все команды, связанные с `python` и `pip`, будут работать только в контексте этого окружения. Это значит, что все библеотеки будут помещаться в директорию виртуального окружения (обычно `venv/lib`), а системные библиотеки останутся неизменными.
- Системная переменная `PATH` временно изменяется, чтобы команды `python` и `pip` указывали на интерпретатор и менеджер пакетов, находящиеся внутри виртуального окружения.
- В командной строке будет отображаться название активированного окружения перед именем пользователя.

>[!Note]
>Если понадобится деактивировать виртуальную среду, то нужно прописать такую команду: `deactivate`.
#### 4. Установите зависимости из `requirements.txt`

Теперь войдя в виртуальное окружение нужно установить все библиотеки и зависимости с помощью команды `pip` и флага `-r`, который говорит pip-у читать построчно файл формата `.txt` (обычно `requirements.txt`, это название принято в сообществе):

```bash
pip install -r requirements.txt
```

Если еще никаких сторонних библиотек не установленно и файла `requirements.txt` нету, то устанавливаем нужные библеотеки командой `pip install <название_пакета>`. 

Важно, что в Python нужно формировать и обновлять `requirements.txt` вручную, поэтому после добовления новых библиотек к себе в окружение нужно прописывать команду `pip freeze > requirements.txt`. Она сохраняет текущие версии всех установленных в виртуальном окружении пакетов в `requirements.txt`.

>[!Note]
>Проверить установленные библиотеки можно командой `pip list`, она выведет списком все установленные в текущем окружение библиотеки (пакеты) и их версий. 

---
# Используемые библиотеки и их назначение

#### `os` — работа с файловой системой

Библиотека **`os`** в Python предоставляет функции для взаимодействия с операционной системой. Она позволяет работать с файловой системой, окружением, процессами и другими аспектами ОС, обеспечивая кроссплатформенный доступ.

#### `moviepy` — обработка видео

`MoviePy` — это мощная библиотека Python для обработки и редактирования видео и аудио. Она позволяет выполнять широкий спектр задач: от простого объединения видео до создания сложных эффектов, нарезки, добавления текста и работы с аудио.

#### `cv2` — анализ видео

`cv2` — это модуль Python из библиотеки **`OpenCV` (Open Source Computer Vision)**. `OpenCV` — одна из самых популярных библиотек для обработки изображений и компьютерного зрения. Она поддерживает работу с изображениями и видео, например, распознавание объектов, обработка видео, фильтрация изображений, работа с камерами и многое другое.

Этот  модуль понадобился нам, так как `MediaPipe` не имеет встроенных функций визуализации, таких как отображение изображения или видео. `OpenCV` используется для захвата данных с камеры, обработки изображений (например, изменения формата цвета) и отображения результатов.

#### `MediaPipe` — анализ видео

`MediaPipe` — это мощная библиотека от Google, которая предоставляет готовые решения для анализа и обработки видео, изображения и данных в реальном времени, таких как отслеживание поз, жестов, лиц, рук и объектов.

